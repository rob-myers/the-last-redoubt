---

key: intro/setup
path: /intro/setup
info: Our setup
label: 'intro: setup'
icon: ðŸš§
date: 2022-10-01
navGroup: 0
prev: intro/
next: intro/js-cli
tags:
  - assets
  - boxy svg
  - node.js
  - react
  - css
  - js cli
  - services
  - graphs
---

import InlineCode from "components/page/InlineCode";

## Our Setup ðŸš§

To [kick things off](/intro) we described our motivation (Game AI), outlined our approach to building/directing the video game, and specified our setting/storyline/influences.
We'll now provide detailed information concerning our development process, expanding on the previous page.

### 1. Assets

The Last Redoubt is a gigantic pyramid housing the remainder of humanity.
Excluding the [Underground Fields](https://www.gutenberg.org/cache/epub/10662/pg10662.html#:~:text=in%20the%20lowest%20tier%20of%20the%20Underground%20Fields%2C "@new-tab") it has [1,320 floors](https://www.gutenberg.org/cache/epub/10662/pg10662.html#:~:text=thousand%20three%20hundred%20and%20twenty%20floors "@new-tab"), each corresponding to a single city.
We only show one floor at a time - although multiple floors are possible via [CSS perspective](https://developer.mozilla.org/en-US/docs/Web/CSS/perspective).
Then:

1. We need graphical assets (to represent the Last Redoubt).
2. We need lots of assets (for 1,320 large cities).
3. We need ways of reusing assets (for feasible dev & debug time).

These problems are solved by Robert Pearce's [Starship Geomorphs](http://travellerrpgblog.blogspot.com/2020/07/starship-geomorphs-20.html) and [Starship Symbols](http://travellerrpgblog.blogspot.com/2020/08/starship-symbols-book.html).

> 1. We'll use the _Starship Symbols_ to represent the Last Redoubt.

> 2. There are over 2000 of them in [PNG format](http://ericbsmith.no-ip.org/geomorphs/), e.g. an [office](/assets/symbol/office--020--2x3.png "@new-tab"), a [bedroom](/assets/symbol/stateroom--020--2x3.png "@new-tab"), a [couch](/assets/symbol/couch-and-chairs--006--0.4x2.png "@new-tab").

> 3. They can be used to reconstruct the approx 600 _Starship Geomorphs_, themselves combinable in countless ways like [this](http://ericbsmith.no-ip.org/images/Geomorphs/LuxuryLiner/Luxury_Liner_Square_Deck_1_Dance_And_Dining.png "@new-tab").

In particular, we can create the cities of the Last Redoubt by combining geomorphs.
But cities have e.g. doors, walls and walkable areas.
To infer these from our "atoms" we use [SVG](https://en.wikipedia.org/wiki/Scalable_Vector_Graphics)s.
That is, for each `{symbol}.png` we create a respective `{symbol}.svg`  e.g. an [office](/assets/symbol/office--020--2x3.svg "@new-tab"), a [bedroom](/assets/symbol/stateroom--020--2x3.svg "@new-tab"), a [couch](/assets/symbol/couch-and-chairs--006--0.4x2.svg "@new-tab").

<aside title="symbol-svg-progress">

So far we've created 66 symbol SVGs.
They're a side-effect of remaking 5 geomorphs:
- `101` [Multi purpose](/assets/geomorph/g-101--multipurpose.png "@new-tab")
- `102` [Research Deck](/assets/geomorph/g-102--research-deck.png "@new-tab")
- `301` [Bridge](/assets/geomorph/g-301--bridge.png "@new-tab")
- `302` [Xboat Repair Bay](/assets/geomorph/g-302--xboat-repair-bay.png "@new-tab")
- `303` [Passenger Deck](/assets/geomorph/g-303--passenger-deck.png "@new-tab")

Please check out the [originals here](http://travellerrpgblog.blogspot.com/2020/07/starship-geomorphs-20.html).

</aside>

These SVGs include the original PNG as an `<image>` with a [data URL](https://developer.mozilla.org/en-US/docs/Web/HTTP/Basics_of_HTTP/Data_URLs).
Try opening [the couch](/assets/symbol/couch-and-chairs--006--0.4x2.svg "@new-tab") and add _view-source:_ as a prefix to the URL.
You'll see something like this (we've redacted the data URL):

```svg
<?xml version="1.0" encoding="utf-8"?>
<svg viewBox="0 0 120 600" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:bx="https://boxy-svg.com">
  <defs>
    <bx:grid x="0" y="0" width="300" height="300"/>
  </defs>
  <g style="">
    <title>background</title>
    <image width="137" height="575" x="-8.097" y="14.064" style="" xlink:href="data:image/png;base64,[REDACTED-DATA-URL]"/>
  </g>
  <g style="">
    <title>obstacles</title>
    <rect width="124" height="574.627" style="fill-opacity: 0.5; fill: rgb(0, 0, 255);" y="15.03" x="-2"/>
  </g>
</svg>
```

Then the additional data amounts to a single rectangular obstacle.
One can see examples of walls, doors and labels by applying _view-source:_ to the other SVGs above.
But how to construct such SVGs?
Technically we could use a text editor but there's a much better way:

> [Boxy SVG](https://boxy-svg.com/).

<!-- are standalone files which can be viewed in an editor -->


<!--
   - Eric Smith provides them in [PNG format](http://ericbsmith.no-ip.org/geomorphs/).
   - Each Geomorph can be remade using them (more or less).
-->

<!--
  Number of Starship Geomorphs aggregated by section
   echo $(( 226 + 160 + 120 + 60 + 44 ))
-->
   
ðŸš§ __IN PROGRESS__ ðŸš§

We'll describe our sources, external software ([Boxy SVG](https://boxy-svg.com/)) and various pipelines.

- [Starship geomorphs](http://travellerrpgblog.blogspot.com/2020/07/starship-geomorphs-20.html) as [PNGs](http://ericbsmith.no-ip.org/geomorphs/).
- [Starship symbols](http://travellerrpgblog.blogspot.com/2020/08/starship-symbols-book.html) as [PNGs](http://ericbsmith.no-ip.org/geomorphs/ "@new-tab")
  - e.g. [1](/assets/symbol/office--020--2x3.png "@new-tab"), [2](/assets/symbol/stateroom--020--2x3.png "@new-tab"), [3](/assets/symbol/couch-and-chairs--006--0.4x2.png "@new-tab").
- Symbols as SVGs via [Boxy SVG](https://boxy-svg.com/)
  - e.g. [1](/assets/symbol/office--020--2x3.svg "@new-tab"), [2](/assets/symbol/stateroom--020--2x3.svg "@new-tab"), [3](/assets/symbol/couch-and-chairs--006--0.4x2.svg "@new-tab").
  - collectively organised as [JSON](/assets/symbol/svg.json "@new-tab").
- Generated geomorphs PNG + JSON
  - e.g. [1](/assets/geomorph/g-301--bridge.png "@new-tab"), [2](/assets/geomorph/g-101--multipurpose.png "@new-tab"), [3](/assets/geomorph/g-303--passenger-deck.png "@new-tab").
- NPC animation via Boxy SVG e.g. [first-npc](/assets/npc/first-npc.svg "@new-tab").
- Generated NPC spritesheets e.g. [first-npc](/assets/npc/first-npc--walk.png "@new-tab").


<aside title="upcoming-article">

#### Upcoming topics

##### ReactJS and CSS

Our components are built using [ReactJS](https://npmjs.com/package/react) and [@emotion/css](https://www.npmjs.com/package/@emotion/css) e.g.

- [GeomorphEdit](https://github.com/rob-myers/the-last-redoubt/blob/migrate-from-nextjs/src/projects/geomorph/GeomorphEdit.jsx "@new-tab"): build/preview [geomorph layouts](https://github.com/rob-myers/the-last-redoubt/blob/migrate-from-nextjs/src/projects/geomorph/geomorph-layouts.js "@new-tab") using SVG symbols.
- [SvgPanZoom](https://github.com/rob-myers/the-last-redoubt/blob/migrate-from-nextjs/src/projects/panzoom/SvgPanZoom.jsx "@new-tab"): pan and zoom using [SVG viewBox attribute](https://developer.mozilla.org/en-US/docs/Web/SVG/Attribute/viewBox).
- [CssPanZoom](https://github.com/rob-myers/the-last-redoubt/blob/migrate-from-nextjs/src/projects/panzoom/CssPanZoom.jsx "@new-tab"): pan and zoom using [CSS transforms](https://developer.mozilla.org/en-US/docs/Web/CSS/transform).
- [World](https://github.com/rob-myers/the-last-redoubt/blob/migrate-from-nextjs/src/projects/world/World.jsx "@new-tab") has subcomponents like _Doors_ and _NPCs_.

React custom hooks (shared component functionality) include:

- [useUpdate](https://github.com/rob-myers/the-last-redoubt/blob/migrate-from-nextjs/src/projects/hooks/use-update.js "@new-tab"): a callback to trigger a component update.
- [useStateRef](https://github.com/rob-myers/the-last-redoubt/blob/migrate-from-nextjs/src/projects/hooks/use-state-ref.js "@new-tab"): like React.useRef and React.useState with HMR persistence.
- [useGeomorphData](https://github.com/rob-myers/the-last-redoubt/blob/migrate-from-nextjs/src/projects/geomorph/use-geomorph-data.js "@new-tab"): geomorph JSON plus derived data.
- [useGeomorphs](https://github.com/rob-myers/the-last-redoubt/blob/migrate-from-nextjs/src/projects/geomorph/use-geomorphs.js "@new-tab"): stitches geomorphs into a global geomorph graph.
- [useHandleEvents](https://github.com/rob-myers/the-last-redoubt/blob/migrate-from-nextjs/src/projects/world/use-handle-events.js "@new-tab"): handle world events from NPCs or a Terminal.


##### JavaScript CLI

We'll direct the game using our own [CLI](https://en.wikipedia.org/wiki/Command-line_interface).
Amongst interpreted commands are [simple commmands](https://www.gnu.org/software/bash/manual/html_node/Simple-Commands.html), and amongst simple commands are builtins e.g.

- <InlineCode>cd</InlineCode> mutates the string-valued variables <code>PWD</code> and <code>OLDPWD</code>.
- <InlineCode>declare</InlineCode> lists variables and functions.
- <InlineCode>echo</InlineCode> outputs its arguments as a single string.
- <InlineCode>get</InlineCode> wraps recursive <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Property_accessors">property accessors</a> using delimiter <code>/</code>.
- <InlineCode>history</InlineCode> list previously executed commands.
- <InlineCode>ls</InlineCode> wraps the JavaScript function <code>Object.keys</code>.
- <InlineCode>ps</InlineCode> list running processes.
- <InlineCode>pwd</InlineCode> outputs the variable <code>PWD</code>.
- <InlineCode>rm</InlineCode> wraps the JavaScript keyword <code>delete</code>.
- <InlineCode>run</InlineCode> runs an async generator.
- <InlineCode>source</InlineCode> interprets a string at a specified location.

We also support e.g. parameter-expansion, brace-expansion, command substitution, function declaration, process output redirection, background processes, subshells, and pipelines.

##### Game AI CLI

We apply the JavaScript CLI to Game AI by defining various functions:

- <InlineCode>awaitWorld</InlineCode> awaits a <i>World</i> component with specified key.
- <InlineCode>click</InlineCode> converts clicks/touches into world coordinates.
- <InlineCode>look</InlineCode> makes an NPC look.
- <InlineCode>nav</InlineCode> computes a navpath for an NPC.
- <InlineCode>npc</InlineCode> permits NPC configuration.
- <InlineCode>spawn</InlineCode> spawns an NPC.
- <InlineCode>track</InlineCode> follows an NPC using panning and zooming.
- <InlineCode>view</InlineCode> pans and zooms.
- <InlineCode>walk</InlineCode> makes an NPC walk.

##### Services

We organise various functionality as _services_:

- [cheerio.js](https://github.com/rob-myers/the-last-redoubt/blob/migrate-from-nextjs/src/projects/service/cheerio.js "@new-tab") e.g. extract polygons from SVG metadata.
- [dom.js](https://github.com/rob-myers/the-last-redoubt/blob/migrate-from-nextjs/src/projects/service/dom.js "@new-tab") e.g. [SVG path](https://www.w3.org/TR/SVG11/paths.html#DAttribute) to polygon; HTMLCanvasElement utilities.
- [geom.js](https://github.com/rob-myers/the-last-redoubt/blob/migrate-from-nextjs/src/projects/service/geom.js "@new-tab") e.g. triangulation and intersection of 2d geometry.
- [geomorph.js](https://github.com/rob-myers/the-last-redoubt/blob/migrate-from-nextjs/src/projects/service/geomorph.js "@new-tab") e.g. create a geomorph JSON given transformed symbols.
- [npc.js](https://github.com/rob-myers/the-last-redoubt/blob/migrate-from-nextjs/src/projects/service/npc.js "@new-tab") e.g. render spritesheet; npc collision prediction.
- [triangle.js](https://github.com/rob-myers/the-last-redoubt/blob/migrate-from-nextjs/src/projects/service/triangle.js "@new-tab") wraps [triangle-wasm](https://www.npmjs.com/package/triangle-wasm), itself a wrapper around [Triangle](https://www.cs.cmu.edu/~quake/triangle.html).

##### Graphs

- [floor graph](https://github.com/rob-myers/the-last-redoubt/blob/migrate-from-nextjs/src/projects/graph/floor-graph.js "@new-tab") for a single geomorph is its navmesh.
- [room graph](https://github.com/rob-myers/the-last-redoubt/blob/migrate-from-nextjs/src/projects/graph/room-graph.js "@new-tab") for a single geomorph has rooms as nodes and doors as edges.
- [geomorph graph](https://github.com/rob-myers/the-last-redoubt/blob/migrate-from-nextjs/src/projects/graph/gm-graph.js "@new-tab") has geomorphs as nodes and hull doors as edges.

</aside>

