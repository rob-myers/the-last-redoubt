---
key: index
date: 2023-04-09
info: Home page
# ‚õîÔ∏è GraphQL error avoided if ‚â• 1 instance of field
giscusTerm: /home
label: home
navGroup: null
next: intro/
path: /
prev: null
tags:
  - npcs
  - cli
  - web dev
  - traveller rpg
---

import Carousel from "components/page/Carousel";
import Icon, { RoadWorksIcon } from "components/page/Icon";
import InlineCode from "components/page/InlineCode";
import SideNote from "components/page/SideNote";
import Tabs from "components/page/Tabs";
import { profileLookup } from "projects/sh/scripts";

## @home

### Introduction

We want to make video games more meaningful.
That is the objective of this website.
We believe video games provide a chance to better understand ourselves.
Sadly, they have become synonymous with meaningless violence, bad storytelling and simplistic character behaviour.
Many exceptions exist e.g. [What Remains of Edith Finch](https://en.wikipedia.org/wiki/What_Remains_of_Edith_Finch) and [The Last of Us Part II](https://en.wikipedia.org/wiki/The_Last_of_Us_Part_II) <SideNote>Admittedly very violent, but not in a meaningless way.</SideNote>.
These games overcome simplistic character behaviour by employing a **tight narrative**, combined with mini-games or constrained scenarios.
But what about a more direct approach?

Meaningless violence and bad storytelling may be side-effects of simplistic character behaviour. If the behaviour was more sophisticated it could help to tell the story, and the game-mechanic needn't revolve around violence. But how to develop more sophisticated character behaviour?
We have a few core ideas.

1. Focus on creating and combining [NPC](https://en.wikipedia.org/wiki/Non-player_character) behaviours without trying to create a video game.

1. Develop differently:
    - Canonical visual representations via HTML and CSS.
    - Canonical scripting via POSIX syntax interpreted as JavaScript.

1. Use openly available assets:
    - Robert Pearce's [Starship Geomorphs](http://travellerrpgblog.blogspot.com/2020/07/starship-geomorphs-20.html).
    - Robert Brook's [Top down men game asset character pack](https://www.gamedeveloperstudio.com/graphics/viewgraphic.php?page-name=Top-down-men-game-asset-character-pack&item=1r6d547z6f232v871n). <SideNote>Not free but only `$14.95` including [Spriter](https://brashmonkey.com/spriter-pro/) source files.</SideNote>

{/* These assets themselves embody [Traveller RPG](https://en.wikipedia.org/wiki/Traveller_(role-playing_game)). */}

To make video games more meaningful, we'll try to surmount simplistic character behaviour.
We'll focus on the problem directly by creating many individual behaviours and combining them in many different ways.
Notice we are creating these behaviours for their own sake, and not inside a video game.

> **This is a difficult thing to do**:
>
> we risk creating something neither of _general interest_ nor with much _entertainment value_.

We tackle _generality_ in a few ways.
Firstly, our implementation uses standard web development techniques.
We use [CSS](https://en.wikipedia.org/wiki/CSS) and the [Web Animations API](https://developer.mozilla.org/en-US/docs/Web/API/Web_Animations_API) for rendering, as opposed to inner loops based on `requestAnimationFrame`.
Then we are applying techniques used by legions of web developers on a daily basis.
Secondly, our approach to scripting is of general interest.
We provide an interactive shell which interprets POSIX syntax as JavaScript and executes it. This is possible via the wonderful shell parser [mvdan-sh](https://github.com/mvdan/sh/tree/master/_js) and [async generators](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/AsyncGenerator).
The resulting [CLI](https://en.wikipedia.org/wiki/Command-line_interface) (Command Line Interface) gives our website its name.
Thirdly, we'll stick to gameplay common to a huge raft of video games e.g.
lying/sitting/standing/walking and opening/closing doors, presented from a top-down perspective.

{/* As for entertainment value... this is relative to being a programmer, or being interested in how programming actually works */}

{/* Points one and two are about the programmatic implementation.
The third point sets the non-character assets, the style (_top-down perspective_) and also provides a pool of ideas we can draw from. */}
We've already built this system, so let's take a look.

<Carousel
  baseSrc="/assets/pics/first-peek/"
  height={550}
  fullHeight={900}
  breakpoints={{
    300: {
      slidesPerView: 1,
    },
    700: {
      slidesPerView: 2,
    },
  }}
  items={[
    { src: 'pic-1.png', label: 'A World and a Terminal' },
  ]}
/>

**OLD BELOW**

{/* 1. To create an interactive system for specifying and executing the behaviour of video game characters.
1. For this interactive system and its implementation to be of interest to a wide audience. */}


We'll **specify behaviour** using the syntax of an interactive programming language.
We'll **execute behaviour** by running (possibly many) programs in parallel.
But what about **(2)** above?
Why should the **implementation details** of our system be of general interest?
Answering this requires some background.

_Game AI_ builds control systems for Non-Player Characters (NPCs) in video games.
Scratching beneath the surface reveals a highly fragmented subject.
Online demos involving [navmeshes](https://www.babylonjs-playground.com/#0DQBXD#42 "@new-tab") and [steering behaviour](https://davenewt.github.io/steering-behaviours/ "@new-tab") exist, but these are ingredients, rather than the rich experiences we seek.
Why does Game AI only seem to exist within the context of a video game?

> Here's a possible reason:
>
> Assets and animations relative to a particular setting are needed to make Game AI meaningful.
In making these choices and constructing the respective assets, one moves away from a general AI system and towards making a video game.

How can we make these choices whilst keeping some level of generality?
This brings us back to **(2)**.
We can _implement_ the choices in a _canonical way_ by adopting the stance of a Modern Web Developer.

üöß Use web technology the way it is supposed to be used.

{/* NPC behaviour may be _simulated_ i.e. task-driven imitations of human behaviour. NPC behaviour may be _fabricated_ i.e. specifically constructed in response to the Player's actions. */}
{/* For example, if the Player enters a particular room we could spawn enemies (fabrication) which are instructed to chase after the Player (simulation). */}

{/* Video games almost always need Game AI e.g. control systems for entities not under control of the Player. */}

---
**OLD BELOW**


This blog is about programming Non-Player Characters (aka [NPCs](https://en.wikipedia.org/wiki/Non-player_character "@new-tab")).
An NPC is a character in a video game e.g. a human, alien, robot or animal.
They are not controlled by the Player.
Sometimes video games run a simulation involving individual NPCs.
Sometimes they fabricate NPC behaviour in response to the Player's actions.
My personal interest began with the ZX Spectrum in the late 1980s.
In those days anything seemed possible.
Nowadays, NPC has even become [an insult](https://en.wikipedia.org/wiki/NPC_(meme)).

There's no need to comment on the current state of affairs of video games.
They have their own metrics of success.
We're going to study NPCs for their own sake.
But what distinguishes our approach?

1. Dedicated to programming NPCs.
1. Browser-based CLI.
1. CSS-based rendering.<SideNote>We intentionally avoid JavaScript [game loops](https://gamedev.stackexchange.com/a/656).</SideNote>
1. Rich graphics via [Starship Geomorphs](http://travellerrpgblog.blogspot.com/2020/07/starship-geomorphs-20.html "@new-tab").

Before things get a bit abstract, here are some screenshots:

<Carousel
  baseSrc="/assets/pics/home-carousel/"
  height={550}
  fullHeight={900}
  breakpoints={{
    300: {
      slidesPerView: 1,
    },
    700: {
      slidesPerView: 2,
    },
  }}
  items={[
    { src: 'pic-1.png', label: 'A World and a Terminal' },
    { src: 'pic-2.png', label: 'Movement and commands' },
    { src: 'pic-3.png', label: 'Another Terminal awaits another World' },
    { src: 'pic-4.png', label: 'Disabling Tabs pauses sessions' },
    { src: 'pic-5.png', label: 'Multiple Worlds and Terminals' },
    { src: 'pic-6.png', label: 'Can resize Tab and Tabset' },
    { src: 'pic-7.png', label: 'Widescreen view' },
    { src: 'pic-8.png', label: 'Pausing a process' },
    { src: 'pic-9.png', label: 'Reading some variables' },
    { src: 'pic-10.png', label: 'Mobile has Terminal UI' },
    { src: 'pic-11.png', label: 'Piping output into devtool' },
  ]}
/>

<Aside title="screenshots">

  _A World and a Terminal_ (1st slide above) depicts a [Tabs component](https://github.com/rob-myers/the-last-redoubt/blob/master/src/components/page/Tabs.tsx#:~:text=function%20Tabs "@new-tab") with five tabs.
  Two of the tabs are visible.
  The left tab is an instance of a [World component](https://github.com/rob-myers/the-last-redoubt/blob/master/src/projects/world/World.jsx#:~:text=export%20default-,function%20World,-(props) "@new-tab") and
  the right tab instantiates a [Terminal component](https://github.com/rob-myers/the-last-redoubt/blob/master/src/components/sh/Terminal.tsx#:~:text=function%20Terminal "@new-tab").
  The `World` shows an NPC from a birdseye perspective.
  {/* The commands in the `Terminal` indicate this is Andros and he is actually the Player. */}
  The other images show the `Tabs`, `World` and `Terminal` in other states.<SideNote width={500}>Some commands shown in the terminals are out-of-date. We now run `npc config debug` to toggle debug mode, rather than `DEBUG=1; npc config`</SideNote>

</Aside>

Let's spend some time expanding the above distinguishing points.

### Browser-based CLI

By this we mean an interactive [Command Line Interface](https://en.wikipedia.org/wiki/Command-line_interface) running in the browser.
Graphically it amounts to [Xterm.js](https://github.com/xtermjs/xterm.js#readme).<SideNote>Keypresses are handled by our own analog of [Readline](https://en.wikipedia.org/wiki/GNU_Readline).</SideNote>
Programmatically it interprets POSIX shell syntax as JavaScript and executes it.<SideNote>We parse shell syntax using the wonderful [mvdan-sh](https://www.npmjs.com/package/mvdan-sh).</SideNote>
Supported syntax includes shell pipelines, shell functions and background processes.
Let's see it in action:

<Carousel
  height={600}
  items={[{ video: 'cli-demo-1', label: 'First CLI Demo' }]}
/>

üöß redo video

As mentioned in the video, every shell session begins by running the script at `/home/PROFILE`.
In the above session this absolute path resolves to a string:

```bash
source /etc/util-1
source /etc/game-1

awaitWorld
spawn andros '{"x":185,"y":390}'
npc set-player andros

# camera follows andros
track andros &
# click navmesh to move
goLoop andros &
# click outside navmesh to look
lookLoop andros &

npc config 'showIds debug'
```

Consider the first line of the newline-delimited string above.
Our shell builtin `source`<SideNote width={340}>`source` behaves like the [Bash builtin](https://www.gnu.org/software/bash/manual/html_node/Bash-Builtins.html#index-source), a synonym for a [Bourne shell builtin](https://www.gnu.org/software/bash/manual/html_node/Bourne-Shell-Builtins.html#index-_002e).</SideNote> will run the script at `/etc/util-1`<SideNote width={360}>`/etc/util-1` resolves to a string defining various shell functions e.g. [`range`](https://github.com/rob-myers/the-last-redoubt/blob/master/src/projects/sh/scripts.ts#:~:text=%7B-,range%3A%20%60%7B "@new-tab")</SideNote>.
The video goes through the rest of this profile, explaining the various commands and their connection to the `World`.

{/* (a) list available shell functions, (b) inspect their definitions, and (c) chain them together using shell pipelines. */}

<Aside title="interpret-js">

But how is shell syntax interpreted as JavaScript?

> Consider our shell function `call`.<br/>
> Given a textual description of a JavaScript function and its arguments, it creates the JavaScript function and its arguments, and finally invokes this function with these arguments.

As another example, the shell builtin `run` creates and iterates a JavaScript [AsyncGenerator function](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/async_function*).
The shell functions `call`, `map`, `range` and `split` (above) are all defined in terms of `run`.

</Aside>

### CSS-based rendering

There are two basic ways to create browser-based video games:
[HTMLCanvasElement](https://developer.mozilla.org/en-US/docs/Web/API/HTMLCanvasElement) and
[CSS](https://developer.mozilla.org/en-US/docs/Web/CSS).
The `<canvas>` amounts to an image we can manipulate via JavaScript.
We can fill shapes, put pixels, or even [render 3D worlds](https://developer.mozilla.org/en-US/docs/Web/API/WebGL_API) at 60 frames per second.
When someone says _HTML5 game_, the underlying tech is almost always the `<canvas>` element.
On the other hand, non-gaming websites rarely use it.

The cornerstones of the World Wide Web are HTML, CSS and JavaScript.
A typical website amounts to a deep [DOM-tree](https://en.wikipedia.org/wiki/Document_Object_Model) initially induced by HTML, brought to life _visually_ via CSS <SideNote>e.g. `<link>` and `<style>` nodes</SideNote> and _interactively_ via JavaScript<SideNote>Technically, JS permits arbitrary DOM mutation.</SideNote>.
Concerning CSS, web browsers interpret it very efficiently.
Its declarative approach avoids re-inventing the wheel via heavy-duty JavaScript.<SideNote>Although HTMLCanvas is performant via [WebGL](https://developer.mozilla.org/en-US/docs/Web/API/WebGL_API), the latter is a low-level API.</SideNote>
Finally, CSS permits _rich interactive debugging_.
That is, one may directly mutate the DOM-tree in a browser devtool,
whereas debugging `<canvas>` amounts to setting breakpoints inside JavaScript code.

{/* CSS vs HTMLCanvas i.e. in our approach we can use Chrome devtool
Asymmetry of HTML and JavaScript DOM mutation
Analogy with Web vs App
Want to use Browser Devtool: canonical interface, like CLI */}

üöß browser devtool video

Writing meaningfully about NPC behaviour will require _many_ flexible interactive demos.
So, we're going to have to write a lot of software,
and we're going to have to do it in a particularly clear manner.
Importantly:

- An in-browser CLI permits:
  > writing, running and managing this software _explicitly_.

- CSS-based rendering provides:
  > performant rendering and particularly rich debugging via a browser devtool.


POSIX-based CLIs are heavily used in e.g. home computing, development environments and cloud computing (infrastructure as a service).
CSS plays a crucial role in personal websites, rich web applications, and [desktop applications](https://www.electronjs.org/) like [VSCode](https://en.wikipedia.org/wiki/Visual_Studio_Code).
Composing these two technologies avoids many UI decisions, for which there is no correct answer.


### Rich graphics via Starship Geomorphs

We want to program NPCs, producing a catalogue of interesting behaviours.
We are particularly interested in studying how they can be composed in response to the Player's actions.
However, NPC behaviours need to be studied at the right level of abstraction.
We are not trying to create _middleware_.
We do not want to create a generic Game AI system, upon which "real games" can be scaffolded.
_Why?_
Because NPC behaviour is highly contextual.
It is usually brought to life via assets representing a specific situation: suitable background scenery and animations of particular denizens.

We definitely need this _spice_ i.e. assets and animations which bring our NPCs to life.
> Thankfully we can use [Starship Geomorphs](http://travellerrpgblog.blogspot.com/2020/07/starship-geomorphs-20.html "@new-tab") by Robert Pearce,
> a large number of aerial-view assets representing Starships, Space-stations, Space-colonies etc.

<Aside title="geomorph">

A _geomorph_ is a rectangular section of a Starship (or Space-station etc.) connectable to others much like Lego.
Each geomorph amounts to a layout of many different rooms of particular types e.g. staterooms (bedrooms), offices, freshers (bathrooms and toilets), labs, infirmaries, lounges etc.

<Carousel
  baseSrc="/assets/geomorph/"
  height={350}
  mobileHeight={300}
  fullHeight={800}
  invert
  items={[
    { src: 'g-301--bridge.png', label: 'Geomorph 301 (Bridge)' },
    { src: 'g-302--xboat-repair-bay.png', label: 'Geomorph 302 (Xboat Repair Bay)' },
    { src: 'g-303--passenger-deck.png', label: 'Geomorph 303 (Passenger Deck)' },
    { src: 'g-101--multipurpose.png', label: 'Geomorph 101 (Multipurpose)' },
    { src: 'g-102--research-deck.png', label: 'Geomorph 102 (Research Deck)' },
  ]}
/>

Above we have recreated some of Robert Pearce's geomorphs using his [Starship Symbols](http://travellerrpgblog.blogspot.com/2020/08/starship-symbols-book.html "@new-tab").

</Aside>


üöß Starship Geomorphs provides assets, but what about _character animations_?
Well, the term "geomorph" actually comes from a pen-and-paper Role-playing Game called Traveller....
We use [Synfig](https://www.synfig.org/ "@new-tab") for character animation.


{/* üöß Please [read the introduction](/intro/). Initially we need a fair amount of exposition.
This reflects our initial work on the "game engine" before we started creating this site.
Partial exposition is indicated by <RoadWorksIcon bottom />. */}

### Demo

üöß Move after cli-video?

üöß Actions speak louder than words.
Click to navigate or interact (e.g. open doors).
You can drag/scroll/pinch to pan and zoom.
Try resetting (<Icon icon="refresh" small inline />), maximising a tab or all tabs (<Icon icon="expand" small inline />), and disabling (<Icon icon="cross-circle" small inline />).
Toggle debug circles by typing <InlineCode copy>npc config debug</InlineCode>.

<Tabs
  id="demo-tabs"
  initEnabled={false}
  height={600}
  persistLayout
  initHorizontal
  tabs={[
    [
      { type: 'component', filepath: 'world-demo-1' },
    ],
    [
      { type: 'terminal', filepath: 'demo-1@test', env: { WORLD_KEY: 'world-demo-1', PROFILE: profileLookup.game_2() } },
    ],
  ]}
/>

### Changelog

| date | change |
| --- | ----------- |
| 2022-??-?? | created [Home page](/) |
|  | created [About](/about) |
|  | created preview [Setup](/intro/setup) |
|  | created preview [JavaScript CLI](/intro/js-cli) |
|  | created preview [Game AI CLI](/intro/ai-cli) |
