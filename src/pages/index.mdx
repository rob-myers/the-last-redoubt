---
key: index
date: 2023-04-09
info: Home page
# ‚õîÔ∏è GraphQL error avoided if ‚â• 1 instance of field
giscusTerm: /home
label: home
navGroup: null
next: intro/
path: /
prev: null
tags:
  - video games
  - character behaviour
  - web dev
  - cli
  - traveller
---

import Carousel from "components/page/Carousel";
import Icon, { RoadWorksIcon } from "components/page/Icon";
import InlineCode from "components/page/InlineCode";
import SideNote from "components/page/SideNote";
import Tabs from "components/page/Tabs";
import Def from "components/page/Def";
import { profileLookup } from "projects/sh/scripts";

## home

### Introduction

We want to make **video games** more meaningful.
That is the objective of this website.
They have become synonymous with meaningless violence, bad storytelling and **simplistic character behaviour**.
On the other hand, there are many exceptions out there.
Recent examples include [What Remains of Edith Finch](https://en.wikipedia.org/wiki/What_Remains_of_Edith_Finch), [Observation](https://en.wikipedia.org/wiki/Observation_(video_game)) and [The Last of Us Part II](https://en.wikipedia.org/wiki/The_Last_of_Us_Part_II) <SideNote>Admittedly very violent, but not in a meaningless way.</SideNote>.
These games avoid simplistic character behaviour by employing a **tight narrative**, combined with exploration, mini-games and constrained scenarios.

<Carousel
  baseSrc="/assets/pics/first-peek/"
  height={550}
  mobileHeight={400}
  fullHeight={900}
  items={[{ video: 'first-peek', label: 'First peek' }]}
/>

Concerning simplistic behaviour,
both meaningless violence and bad storytelling may actually be _side-effects_. If the behaviour was more sophisticated it could help tell the story,
and the game-mechanic needn't revolve around violence.
Rather than avoiding the problem by tightening the narrative,
we'd prefer to develop more sophisticated character behaviour.
But how?
We have a few core ideas.

{/* some kinds of "sophisticated" character behaviour may be incompatible with a video game e.g. players replaying scenarios in "Last of Us" may want to repeatability */}

1. Create and combine character behaviours without trying to create a video game.
   
1. Develop differently:
    - Canonical visual representations via HTML and CSS.
    - Canonical in-browser scripting via POSIX syntax interpreted as JavaScript.

1. Use openly available assets:
    - Robert Pearce's [Starship Geomorphs](http://travellerrpgblog.blogspot.com/2020/07/starship-geomorphs-20.html "@new-tab") and Eric Smith's [PNG format](http://ericbsmith.no-ip.org/geomorphs/ "@new-tab").
    - Robert Brook's [Top down men game asset character pack](https://www.gamedeveloperstudio.com/graphics/viewgraphic.php?page-name=Top-down-men-game-asset-character-pack&item=1r6d547z6f232v871n "@new-tab"). <SideNote>Not free but only `$14.95` including [Spriter](https://brashmonkey.com/spriter-pro/) source files.</SideNote>

1. Avoid an abstract approach by using the [Traveller universe](https://en.wikipedia.org/wiki/Traveller_(role-playing_game)) as a backdrop.<SideNote width={300}>The concept of Starship Geomorph comes from Traveller.</SideNote>

Then we intend to approach the problem directly,
by creating and combining many behaviours for their own sake.
This is a difficult thing to do: we risk creating something neither of **general interest** nor with much **entertainment value**.

<Carousel
  baseSrc="/assets/pics/first-peek/"
  height={600}
  mobileHeight={450}
  fullHeight={800}
  breakpoints={{
    300: {
      slidesPerView: 1,
    },
    700: {
      slidesPerView: 1,
    },
  }}
  items={[
    { src: 'npcs-1.png', webp: true, label: 'A World (left) and a Terminal (right)' },
    { src: 'npcs-2.png', webp: true, label: 'Each World provides a birdsye view.' },
    { src: 'npcs-3.png', webp: true, label: 'Each World is driven by one or more Terminals.' },
  ]}
/>

We tackle _general interest_ in a few ways.

- Our implementation uses standard web development techniques.
For example we use [CSS](https://en.wikipedia.org/wiki/CSS) and the [Web Animations API](https://developer.mozilla.org/en-US/docs/Web/API/Web_Animations_API) for rendering, rather than inner loops invoking [`requestAnimationFrame`](https://developer.mozilla.org/en-US/docs/Web/API/window/requestAnimationFrame).

- Our in-browser scripting is of general interest.
We provide an interactive shell interpreting POSIX syntax as JavaScript.<SideNote width={300}>Achieved via the wonderful shell parser [mvdan-sh](https://github.com/mvdan/sh/tree/master/_js), plus recursively defined [async generators](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/AsyncGenerator).</SideNote>
The resulting Command Line Interface ([CLI](https://en.wikipedia.org/wiki/Command-line_interface)) gives our website its name.

- Finally we'll stick to gameplay relevant to a huge raft of video games, presented from a top-down perspective.

But what about _entertainment value_?
We'll program Non-player Characters ([NPCs](https://en.wikipedia.org/wiki/Non-player_character)) and programming requires patience.
Entertainment will arise by interacting with our little fabricated worlds.
By contextualising behaviour within [Traveller RPG](https://en.wikipedia.org/wiki/Traveller_(role-playing_game)) we'll avoid a dry abstract approach.


### Fabricating a behaviour

What actually _is_ a character behaviour?
Answering this requires a number of concepts, i.e.
World, NPC, Player and Command.

<Def title="world">

  #### Definition: World
  
  A _World_ is a React function component [`<World>`](https://github.com/rob-myers/the-last-redoubt/blob/staging/src/projects/world/World.jsx "@new-tab").
  
  Its required props are `worldKey` (string) and
  `gms` (objects `{gmKey, transform}`)
  specifying geomorphs and where to put them.
  Its [`state`](https://github.com/rob-myers/the-last-redoubt/blob/staging/src/projects/world/World.jsx#:~:text=const%20state "@new-tab") is stored under `worldKey` in an application-wide [QueryClient](https://tanstack.com/query/v4/docs/react/reference/QueryClient "@new-tab").
  Then it provides an external API, denoted `api`.

</Def>

At present, we support 5 geomorphs<SideNote width={300}>Robert Pearce [provided hundreds](http://travellerrpgblog.blogspot.com/2020/07/starship-geomorphs-20.html "@new-tab").</SideNote> constructed from about 80 of Robert Pearce's [Starship Symbols](http://travellerrpgblog.blogspot.com/2020/08/starship-symbols-book.html "@new-tab")<SideNote>Available in PNG format on [Eric Smith's site](http://ericbsmith.no-ip.org/geomorphs/ "@new-tab").</SideNote>

<Carousel
  baseSrc="/assets/geomorph/"
  height={450}
  mobileHeight={350}
  fullHeight={800}
  items={[
    { src: 'g-101--multipurpose.map.png', webp: true, label: 'Geomorph 101 (Multipurpose)' },
    { src: 'g-102--research-deck.map.png', webp: true, label: 'Geomorph 102 (Research Deck)' },
    { src: 'g-301--bridge.map.png', webp: true, label: 'Geomorph 301 (Bridge)' },
    { src: 'g-302--xboat-repair-bay.map.png', webp: true, label: 'Geomorph 302 (Xboat Repair Bay)' },
    { src: 'g-303--passenger-deck.map.png', webp: true, label: 'Geomorph 303 (Passenger Deck)' },
  ]}
/>

The thin white rectangles are _doors_. The larger doors on the edges are called _hull doors_.
The geomorphs should be transformed so each hull door either (a) touches nothing else, (b) coincides with another hull door.
Intuitively we "glue" geomorphs together at their hull doors.
Below we have combined `101`, `301`, and also `101`, `102`, `303`.

<Tabs
  id="world-map-only"
  initEnabled={false}
  height={[500, 600]}
  persistLayout
  tabs={[
    [
      { type: 'component', class: 'World', filepath: 'map-only-1', props: {
          init: { x: 600, y: 600, zoom: 0.3 },
          worldKey: 'map-only-1',
          gms: [
            { gmKey: 'g-101--multipurpose', transform: [-1, 0, 0, 1, 1200, 0] },
            { gmKey: 'g-301--bridge', transform: [0, 1, -1, 0, 1200 + 600, 0] },
            { gmKey: 'g-301--bridge', transform: [0, -1, 1, 0, -600, 1200], },
          ],
      }},
      { type: 'component', class: 'World', filepath: 'map-only-2', props: {
          init: { x: 600, y: 600, zoom: 0.3 },
          worldKey: 'map-only-2',
          gms: [
            { gmKey: 'g-101--multipurpose' },
            { gmKey: 'g-102--research-deck', transform: [1, 0, 0, 1, 1200, 0] },
            { gmKey: 'g-102--research-deck', transform: [-1, 0, 0, 1, 0, 0] },
            { gmKey: 'g-303--passenger-deck', transform: [1, 0, 0, 1, 0, -600] },
            { gmKey: 'g-303--passenger-deck', transform: [1, 0, 0, -1, 0, 600 + 1200] },
          ],
      }},
    ],
  ]}
/>

Worlds need NPCs and in particular the Player.

<Def title="npc-and-player">

  #### Definitions: NPC, Player
  
  An _NPC_ is a React function component [`<NPC>`](https://github.com/rob-myers/the-last-redoubt/blob/staging/src/projects/world/NPC.jsx "@new-tab").
  
  Its props are `api` and `npcKey` (string).
  Its state is stored at `api.npcs.npc[npcKey]` created by
  [`create-npc.js`](https://github.com/rob-myers/the-last-redoubt/blob/staging/src/projects/world/create-npc.js "@new-tab").
  
  The _Player_ is an _NPC_ such that `api.npcs.playerKey` is the respective `npcKey`.

</Def>

{/* üöß clarify how api.npcs.playerKey is used */}


üöß shell command (or _command_)

üöß game command: command using some World API

üöß npc behaviour (or _behaviour_): game command using some World npcs API

{/* We'll **specify behaviour** using the syntax of an interactive programming language.
We'll **execute behaviour** by running (possibly many) programs in parallel.
But what about **(2)** above?
Why should the **implementation details** of our system be of general interest?
Answering this requires some background.

_Game AI_ builds control systems for Non-Player Characters (NPCs) in video games.
Scratching beneath the surface reveals a highly fragmented subject.
Online demos involving [navmeshes](https://www.babylonjs-playground.com/#0DQBXD#42 "@new-tab") and [steering behaviour](https://davenewt.github.io/steering-behaviours/ "@new-tab") exist, but these are ingredients, rather than the rich experiences we seek.
Why does Game AI only seem to exist within the context of a video game?

> Here's a possible reason:
>
> Assets and animations relative to a particular setting are needed to make Game AI meaningful.
In making these choices and constructing the respective assets, one moves away from a general AI system and towards making a video game.

*/}

{/* NPC behaviour may be _simulated_ i.e. task-driven imitations of human behaviour. NPC behaviour may be _fabricated_ i.e. specifically constructed in response to the Player's actions. */}
{/* For example, if the Player enters a particular room we could spawn enemies (fabrication) which are instructed to chase after the Player (simulation). */}

{/* Video games almost always need Game AI e.g. control systems for entities not under control of the Player. */}

{/* This blog is about programming Non-Player Characters (aka [NPCs](https://en.wikipedia.org/wiki/Non-player_character "@new-tab")).
An NPC is a character in a video game e.g. a human, alien, robot or animal.
They are not controlled by the Player.
Sometimes video games run a simulation involving individual NPCs.
Sometimes they fabricate NPC behaviour in response to the Player's actions.
My personal interest began with the ZX Spectrum in the late 1980s.
In those days anything seemed possible.
Nowadays, NPC has even become [an insult](https://en.wikipedia.org/wiki/NPC_(meme)). */}

{/* <Aside title="screenshots">

  _A World and a Terminal_ (1st slide above) depicts a [Tabs component](https://github.com/rob-myers/the-last-redoubt/blob/master/src/components/page/Tabs.tsx#:~:text=function%20Tabs "@new-tab") with five tabs.
  Two of the tabs are visible.
  The left tab is an instance of a [World component](https://github.com/rob-myers/the-last-redoubt/blob/master/src/projects/world/World.jsx#:~:text=export%20default-,function%20World,-(props) "@new-tab") and
  the right tab instantiates a [Terminal component](https://github.com/rob-myers/the-last-redoubt/blob/master/src/components/sh/Terminal.tsx#:~:text=function%20Terminal "@new-tab").
  The `World` shows an NPC from a birdseye perspective.
  The other images show the `Tabs`, `World` and `Terminal` in other states.<SideNote width={500}>Some commands shown in the terminals are out-of-date. We now run `npc config debug` to toggle debug mode, rather than `DEBUG=1; npc config`</SideNote>

</Aside> */}

{/* By this we mean an interactive [Command Line Interface](https://en.wikipedia.org/wiki/Command-line_interface) running in the browser.
Graphically it amounts to [Xterm.js](https://github.com/xtermjs/xterm.js#readme).<SideNote>Keypresses are handled by our own analog of [Readline](https://en.wikipedia.org/wiki/GNU_Readline).</SideNote>
Programmatically it interprets POSIX shell syntax as JavaScript and executes it.<SideNote>We parse shell syntax using the wonderful [mvdan-sh](https://www.npmjs.com/package/mvdan-sh).</SideNote>
Supported syntax includes shell pipelines, shell functions and background processes.
Let's see it in action:

As mentioned in the video, every shell session begins by running the script at `/home/PROFILE`.
In the above session this absolute path resolves to a string:

```bash
source /etc/util-1
source /etc/game-1

awaitWorld
spawn andros '{"x":185,"y":390}'
npc set-player andros

# camera follows andros
track andros &
# click navmesh to move
goLoop andros &
# click outside navmesh to look
lookLoop andros &

npc config 'showIds debug'
```

Consider the first line of the newline-delimited string above.
Our shell builtin `source`<SideNote width={340}>`source` behaves like the [Bash builtin](https://www.gnu.org/software/bash/manual/html_node/Bash-Builtins.html#index-source), a synonym for a [Bourne shell builtin](https://www.gnu.org/software/bash/manual/html_node/Bourne-Shell-Builtins.html#index-_002e).</SideNote> will run the script at `/etc/util-1`<SideNote width={360}>`/etc/util-1` resolves to a string defining various shell functions e.g. [`range`](https://github.com/rob-myers/the-last-redoubt/blob/master/src/projects/sh/scripts.ts#:~:text=%7B-,range%3A%20%60%7B "@new-tab")</SideNote>.
The video goes through the rest of this profile, explaining the various commands and their connection to the `World`. */}

{/* (a) list available shell functions, (b) inspect their definitions, and (c) chain them together using shell pipelines. */}

{/* <Aside title="interpret-js">

But how is shell syntax interpreted as JavaScript?

> Consider our shell function `call`.<br/>
> Given a textual description of a JavaScript function and its arguments, it creates the JavaScript function and its arguments, and finally invokes this function with these arguments.

As another example, the shell builtin `run` creates and iterates a JavaScript [AsyncGenerator function](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/async_function*).
The shell functions `call`, `map`, `range` and `split` (above) are all defined in terms of `run`.

</Aside> */}

{/* There are two basic ways to create browser-based video games:
[HTMLCanvasElement](https://developer.mozilla.org/en-US/docs/Web/API/HTMLCanvasElement) and
[CSS](https://developer.mozilla.org/en-US/docs/Web/CSS).
The `<canvas>` amounts to an image we can manipulate via JavaScript.
We can fill shapes, put pixels, or even [render 3D worlds](https://developer.mozilla.org/en-US/docs/Web/API/WebGL_API) at 60 frames per second.
When someone says _HTML5 game_, the underlying tech is almost always the `<canvas>` element.
On the other hand, non-gaming websites rarely use it.

The cornerstones of the World Wide Web are HTML, CSS and JavaScript.
A typical website amounts to a deep [DOM-tree](https://en.wikipedia.org/wiki/Document_Object_Model) initially induced by HTML, brought to life _visually_ via CSS <SideNote>e.g. `<link>` and `<style>` nodes</SideNote> and _interactively_ via JavaScript<SideNote>Technically, JS permits arbitrary DOM mutation.</SideNote>.
Concerning CSS, web browsers interpret it very efficiently.
Its declarative approach avoids re-inventing the wheel via heavy-duty JavaScript.<SideNote>Although HTMLCanvas is performant via [WebGL](https://developer.mozilla.org/en-US/docs/Web/API/WebGL_API), the latter is a low-level API.</SideNote>
Finally, CSS permits _rich interactive debugging_.
That is, one may directly mutate the DOM-tree in a browser devtool,
whereas debugging `<canvas>` amounts to setting breakpoints inside JavaScript code. */}

{/* Writing meaningfully about NPC behaviour will require _many_ flexible interactive demos.
So, we're going to have to write a lot of software,
and we're going to have to do it in a particularly clear manner.
Importantly:

- An in-browser CLI permits:
  > writing, running and managing this software _explicitly_.

- CSS-based rendering provides:
  > performant rendering and particularly rich debugging via a browser devtool.

POSIX-based CLIs are heavily used in e.g. home computing, development environments and cloud computing (infrastructure as a service).
CSS plays a crucial role in personal websites, rich web applications, and [desktop applications](https://www.electronjs.org/) like [VSCode](https://en.wikipedia.org/wiki/Visual_Studio_Code).
Composing these two technologies avoids many UI decisions, for which there is no correct answer. */}


{/* We want to program NPCs, producing a catalogue of interesting behaviours.
We are particularly interested in studying how they can be composed in response to the Player's actions.
However, NPC behaviours need to be studied at the right level of abstraction.
We are not trying to create _middleware_.
We do not want to create a generic Game AI system, upon which "real games" can be scaffolded.
_Why?_
Because NPC behaviour is highly contextual.
It is usually brought to life via assets representing a specific situation: suitable background scenery and animations of particular denizens.

We definitely need this _spice_ i.e. assets and animations which bring our NPCs to life.
> Thankfully we can use [Starship Geomorphs](http://travellerrpgblog.blogspot.com/2020/07/starship-geomorphs-20.html "@new-tab") by Robert Pearce,
> a large number of aerial-view assets representing Starships, Space-stations, Space-colonies etc.

<Aside title="geomorph">

A _geomorph_ is a rectangular section of a Starship (or Space-station etc.) connectable to others much like Lego.
Each geomorph amounts to a layout of many different rooms of particular types e.g. staterooms (bedrooms), offices, freshers (bathrooms and toilets), labs, infirmaries, lounges etc.

<Carousel
  baseSrc="/assets/geomorph/"
  height={350}
  mobileHeight={300}
  fullHeight={800}
  invert
  items={[
    { src: 'g-301--bridge.map.png', label: 'Geomorph 301 (Bridge)' },
    { src: 'g-302--xboat-repair-bay.map.png', label: 'Geomorph 302 (Xboat Repair Bay)' },
    { src: 'g-303--passenger-deck.map.png', label: 'Geomorph 303 (Passenger Deck)' },
    { src: 'g-101--multipurpose.map.png', label: 'Geomorph 101 (Multipurpose)' },
    { src: 'g-102--research-deck.map.png', label: 'Geomorph 102 (Research Deck)' },
  ]}
/>

Above we have recreated some of Robert Pearce's geomorphs using his [Starship Symbols](http://travellerrpgblog.blogspot.com/2020/08/starship-symbols-book.html "@new-tab").

</Aside>


üöß Starship Geomorphs provides assets, but what about _character animations_?
Well, the term "geomorph" actually comes from a pen-and-paper Role-playing Game called Traveller....
We use [Synfig](https://www.synfig.org/ "@new-tab") for character animation. */}


{/* üöß Please [read the introduction](/intro/). Initially we need a fair amount of exposition.
This reflects our initial work on the "game engine" before we started creating this site.
Partial exposition is indicated by <RoadWorksIcon bottom />. */}

{/* ### Demo */}

{/* üöß Move after cli-video? */}

{/* üöß Actions speak louder than words.
Click to navigate or interact (e.g. open doors).
You can drag/scroll/pinch to pan and zoom.
Try resetting (<Icon icon="refresh" small inline />), maximising a tab or all tabs (<Icon icon="expand" small inline />), and disabling (<Icon icon="cross-circle" small inline />).
Toggle debug circles by typing <InlineCode copy>npc config debug</InlineCode>. */}

{/* ### Changelog

| date | change |
| --- | ----------- |
| 2022-??-?? | created [Home page](/) |
|  | created [About](/about) |
|  | created preview [Setup](/intro/setup) |
|  | created preview [JavaScript CLI](/intro/js-cli) |
|  | created preview [Game AI CLI](/intro/ai-cli) | */}
